<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basic VR Scene with Movement</title>
    <style>
        body { margin: 0; }
        canvas { display: block; }
    </style>
</head>
<body>
    <script type="importmap">
    {
        "imports": {
            "three": "./scripts/three.module.min.js",
            "VRButton": "./scripts/VRButton.js"
        }
    }
    </script>
    <script type="module">
        import * as THREE from 'three';
        import { VRButton } from 'VRButton';

        let camera, scene, renderer;
        let cube;

        init();
        animate();

        function init() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);
            
            // Check for WebXR support
            if (navigator.xr) {
                navigator.xr.isSessionSupported('immersive-vr').then((supported) => {
                    if (supported) {
                        // WebXR is supported, so we add the VRButton to the document
                        document.body.appendChild(VRButton.createButton(renderer));

                        renderer.xr.addEventListener('sessionstart', onSessionStart);
                        renderer.xr.addEventListener('sessionend', onSessionEnd);
                    } else {
                        // WebXR is not supported, so we can choose to hide or not add the VR button,
                        // or display some alternative content or message to the user.
                        console.log("WebXR is not supported.");
                    }
                });
            } else {
                // navigator.xr does not exist, indicating that WebXR is definitely not supported
                console.log("WebXR is not supported.");
            }
            
            // Create cube
            const geometry = new THREE.BoxGeometry();
            const material = new THREE.MeshBasicMaterial({ color: 'purple' }); // Purple color
            cube = new THREE.Mesh(geometry, material);
            scene.add(cube);

            // Adjust camera position
            camera.position.z = 5;

            window.addEventListener('resize', onWindowResize);
        }

        function animate() {
            renderer.setAnimationLoop(render);
        }

        function render() {
            renderer.render(scene, camera);
        }

        function onWindowResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        function onSessionStart() {
            // Function to handle VR session start
            console.log("VR session started.");
            // Change cube color to blue when entering VR
            cube.material.color.set('blue'); // Blue color
            // Adjust cube position for VR
            cube.position.set(0, 1.6, -3); // Position the cube at eye level
        }

        function onSessionEnd() {
            // Function to handle VR session end
            console.log("VR session ended.");
            // Change cube color back to purple when exiting VR
            cube.material.color.set('purple'); // Purple color
            // Reset cube position
            cube.position.set(0, 0, 0); // Reset cube position to origin
        }
    </script>
</body>
</html>
